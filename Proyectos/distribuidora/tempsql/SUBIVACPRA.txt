SELECT 	'AA' as grupo,Csrmaopera.id as id,Csrmaopera.numcomp as numcomp,LEFT(CONVERT(Char,CsrCabeza.fecha,112),8) as chrfecha
	,(case when CsrMaopera.estado='0' then CsrCabeza.cnombre else 'COMPROBANTE ANULADO          ' end) as cnombre
	,CsrCabeza.cuit as cuit,ISNULL(CsrCabeza.signo,1)*(-1) as signo,ISNULL(Csrtablaimp.tasa,00.00) as tasa
	,convert(varchar(10),CsrMaopera.fechaserver,105) as fechaserver
	,(Case when Csrtablaimp.tipoconce='PB'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalPB
	,(Case when Csrtablaimp.tipoconce='PG'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalPG
	,(Case when Csrtablaimp.tipoconce='PI'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalPI
	,(Case when Csrtablaimp.tipoconce='PN'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalPN
	,(Case when Csrtablaimp.tipoconce='EX'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalEX
	,(Case when Csrtablaimp.tipoconce='RB'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalRB
	,(Case when Csrtablaimp.tipoconce='RG'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalRG
	,(Case when Csrtablaimp.tipoconce='RI'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalRI
	,(Case when Csrtablaimp.tipoconce='NG'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalNG
	,(Case when Csrtablaimp.tipoconce='IG'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalIG
	,(Case when Csrtablaimp.tipoconce='OI'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalOI
	,(Case when Csrtablaimp.tipoconce='II'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalII
	,(Case when Csrtablaimp.tipoconce='IN'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalIN
	,(Case when Csrtablaimp.tipoconce='IP'
		then ISNULL(Csrtablaimp.importe * ISNULL(CsrCabeza.signo,1)*(-1),CAST( 0 AS NUMERIC(11,2))) else CAST( 0 AS NUMERIC(11,2)) end) as TotalIP
	,ISNULL(CsrCategoiva.abrevia,'RM') as nomcatego,Csrcomprobante.cabrevia as nomcompro,CAST(0 as int) as idprovincia
	 
from Cabecpra as CsrCabeza
left join maopera as Csrmaopera on CsrCabeza.idmaopera = Csrmaopera.id
left join categoiva as Csrcategoiva on CsrCabeza.idtipoiva = Csrcategoiva.id
left join comprobante as Csrcomprobante on Csrmaopera.idcomproba = Csrcomprobante.id
left join tablaimp as csrtablaimp on Csrmaopera.id = csrtablaimp.idmaopera


where CsrCabeza.pefiscal >= 201606 and CsrCabeza.pefiscal < 201607 and Csrmaopera.origen IN ('CPR') and Csrmaopera.clasecomp IN ('A','B','C','U') AND LEFT(CsrMaopera.numcomp,1)<>' '
 and CsrComprobante.libroiva=1 and CsrCabeza.idctacte  > 0 and CsrMaopera.estado='0'
and CsrMaopera.idcomproba  > 0
