SELECT CONVERT(CHAR(10), Csrcabefac.Fecha, 103) as fecha,cast (0 as int) as idmaopera,space(15) as numcomp ,SPACE(5) as cabrevia, space(2) as clasecomp,SPACE(3) as abrevia,SPACE(13) as cuit,SPACE(1) as CodClaseValor
,CAST( 0 as numeric(18,2)) as Preunitario
,cast(0 as int) as Idarticulo,'00000' as codigo,'Total' as articulo, 0 as pesable,CAST(0 as numeric (12,4)) as peso,	ISNULL(CsrCtaProveedor.Id,CAST(0 as int)) as IdProveedor,convert(int,ISNULL(CsrCtaProveedor.cnumero,'')) as CodProveedor,ISNULL(CsrCtaProveedor.cnombre,'PROVEEDOR') as NomProveedor,cast(0 as int) as idFletero,0000 as codfletero,SPACE(30) as nomfletero,	    	ISNULL(CsrMaopera.idvendedor,CAST(-1 as int)) as idVendedor
	    	,ISNULL(CsrCabeVendedor.numero,CAST(0 as numeric(5,0))) as CodVendedor
	    	,ISNULL(CsrCabeVendedor.nombre,'SIN RUTA ASIGNADA') as nomvendedor
,cast(0 as int) as idCtacte,SPACE(6) as ctacte,SPACE(30) as nomcliente,CAST(0 as int) as idcategoria,space(1) as cdireccion,cast(0 as int) as idrubro,00000 as codrubro,SPACE(30) as nomrubro,cast(0 as int) as idvariedad,CAST(0 as int) as CodVariedad,SPACE(30) as nomvariedad
,SUM(CAST(Csrcuerfac.boniciva * CsrCabefac.Signo as numeric(18,2))) as Boniciva
,SUM(CAST(Csrcuerfac.bonisiva * CsrCabefac.Signo as numeric(18,2))) as Bonisiva
,SUM(CAST(Csrcuerfac.bonisiva * CsrCabefac.Signo as numeric(18,2))) as Bonificacion
,SUM(CAST(Csrcuerfac.cantidad *  CsrCabefac.signo  as numeric(15,2))) as unidades
,SUM(CAST(Csrcuerfac.cantidad /Csrcuerfac.unibulto *  CsrCabefac.signo  as numeric(15,2))) as CanBultos
,SUM(CAST(Csrcuerfac.interno * Csrcuerfac.cantidad *  CsrCabefac.signo  as numeric(18,2))) as internos
,SUM((case when CsrCuerfac.pesable = 1 
	then (CAST(Csrcuerfac.kilos *  CsrCabefac.signo  as numeric(18,2))) 
	else (CAST(Csrproducto.peso * Csrcuerfac.cantidad *  CsrCabefac.signo  as numeric(18,3)))
	end)) as Vtakilos	
,SUM((case when CsrCuerfac.pesable = 1 
	then (CAST(Csrcuerfac.kilos *  CsrCabefac.signo  as numeric(18,2))) 
	else (CAST(Csrproducto.volumen * Csrcuerfac.cantidad *  CsrCabefac.signo  as numeric(18,2)))
	end)) as VtaLitros	
,SUM(CAST(CAST(ROUND(CsrCuerfac.totalsiva,2) as numeric(18,2))* CsrCabefac.signo  as numeric(15,2))) as totalng
,SUM((case when Csrcuerfac.pesable = 1 
	then CAST(Csrcuerfac.precosto * Csrcuerfac.kilos *  CsrCabefac.signo  * CAST(csrcuerfac.espromocion as numeric(8,3)) as numeric(18,2))
	else ((case when Csrcuerfac.Univenta=1 or csrcuerfac.unibulto=1 
		then CAST(Csrcuerfac.precosto * Csrcuerfac.cantidad * CAST(csrcuerfac.espromocion as numeric(8,3)) *  CsrCabefac.signo  as numeric(18,2)) 
		else CAST(ROUND((Csrcuerfac.precosto * csrcuerfac.unibulto),2) * (Csrcuerfac.cantidad/Csrcuerfac.unibulto) * CAST(csrcuerfac.espromocion as numeric(8,3)) * CsrCabefac.Signo as numeric(18,2)) 
		end))
	end)) as promocion
,SUM(CAST(ROUND(Csrcuerfac.totalsiva,2) as numeric(18,2))* CsrCabefac.signo ) as ImporteFinal
,SUM((case when csrcuerfac.espromocion=1 
	then 0 else(case when Csrcuerfac.pesable = 1 
		then CAST(Csrcuerfac.precostosiva * Csrcuerfac.kilos *  CsrCabefac.signo  as numeric(18,2))
		else ((case when Csrcuerfac.Univenta=1 or csrcuerfac.unibulto=1 
			then CAST(Csrcuerfac.precostosiva * Csrcuerfac.cantidad *  CsrCabefac.signo  as numeric(18,2)) 
			else CAST(ROUND((Csrcuerfac.precostosiva * csrcuerfac.unibulto),2) * (Csrcuerfac.cantidad/Csrcuerfac.unibulto) *   CsrCabefac.signo  as numeric(18,2)) 
			end))
		end)
	end)) as costosiva
,SUM((case when csrcuerfac.espromocion=1 
	then 0 
	else(case when Csrcuerfac.pesable = 1 
		then CAST(Csrcuerfac.precosto * Csrcuerfac.kilos *  CsrCabefac.signo  as numeric(18,2))
		else ((case when Csrcuerfac.Univenta=1 or csrcuerfac.unibulto=1 
			then CAST(Csrcuerfac.precosto * Csrcuerfac.cantidad *  CsrCabefac.signo  as numeric(18,2)) 
			else CAST(ROUND((Csrcuerfac.precosto * csrcuerfac.unibulto),2) * (Csrcuerfac.cantidad/Csrcuerfac.unibulto)*  CsrCabefac.signo  as numeric(18,2)) 
			end))
		end)
	end))as costoCiva
,SUM((case when LEFT(Csrmaopera.numcomp,1)='A' and CsrCabefac.signo=1 then 1 else 0 end)) as fac_a
,SUM((case when LEFT(Csrmaopera.numcomp,1)='A' and CsrCabefac.signo<>1 then 1 else 0 end)) as nc_a
,SUM((case when LEFT(Csrmaopera.numcomp,1)<>'A' and CsrCabefac.signo=1 then 1 else 0 end)) as fac_b
,SUM((case when LEFT(Csrmaopera.numcomp,1)<>'A' and CsrCabefac.signo<>1 then 1 else 0 end)) as nc_b
,CAST(0 as numeric(18,2)) as Netogravado
,CAST(0 as numeric(18,2)) as Netosinbonificar

from cuerfac as Csrcuerfac
left join maopera as Csrmaopera on Csrcuerfac.idmaopera = Csrmaopera.id
left join cabefac as csrcabefac on Csrcuerfac.idcabeza = Csrcabefac.id
left join producto as Csrproducto on Csrcuerfac.idarticulo = Csrproducto.id
LEFT JOIN Ctacte as CsrCtacte on CsrCabefac.idctacte = CsrCtacte.id
left join ctacte as CsrCtaProveedor on CsrProducto.idctacte = CsrCtaProveedor.id
left join rubro as Csrrubro on Csrproducto.idrubro = CsrRubro.id
left join Comprobante as CsrComprobante on CsrMaopera.idcomproba = CsrComprobante.id
left join Categoiva as CsrCategoiva on CsrCabefac.idcategoria = CsrCategoiva.id
left join PlanPago as CsrPlanPago on CsrCabefac.idplanpago = CsrPlanPago.id
left join Valor as CsrValor on CsrPlanPago.idvalor = CsrValor.id
left join ClaseValor as CsrClaseValor on CsrValor.idclase = CsrClaseValor.id

 

left join vendedor as CsrCabeVendedor on CsrMaopera.idvendedor = CsrCabeVendedor.id 
where CsrMaopera.origen IN ('FAC','FPE') and  not (Csrmaopera.clasecomp in ('K')) and Csrmaopera.estado<>'1'
and Csrcabefac.fecha >= '20160601' AND Csrcabefac.fecha < '20160701' 
and csrcuerfac.idarticulo>0 and Csrcabefac.Idctacte>-1 and Csrcuerfac.Idarticulo>-1 and Csrproducto.idestado in (1,2) 
and CsrCtacte.Idcanalvta >0  and CsrCabefac.Idfletero >0  and ISNULL(CsrMaopera.Idvendedor,0)>-1
and ((CsrMaopera.clasecomp='X' and ISNULL(CsrCabefac.facturado,0)=0) or CsrMaopera.clasecomp<>'X')
  


and CsrCuerfac.escambio  = 0
Group by CONVERT(CHAR(10), Csrcabefac.Fecha, 103),CsrMaopera.idvendedor,CsrCabeVendedor.numero,CsrCabeVendedor.nombre,  	CsrCtaProveedor.Id,CsrCtaProveedor.cnumero,CsrCtaProveedor.cnombre 
Order by CONVERT(CHAR(10), Csrcabefac.Fecha, 103),CsrCabevendedor.numero, CsrCtaProveedor.codproveedor